{"ast":null,"code":"import _regeneratorRuntime from\"/home/sofi/Documentos/SpatialArdhi/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/sofi/Documentos/SpatialArdhi/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/sofi/Documentos/SpatialArdhi/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useReducer}from\"react\";import AuthContext from\"./AuthContext\";import AuthReducer from\"./AuthReducer\";import tokenAuth from\"../../config/token\";import axios from'axios';import{REGISTERED,REGISTER_ERROR,GET_USER,LOGIN_OK,LOGIN_ERROR,GETUSER_ERROR,LOG_OUT}from\"../../types\";import{API_URL_LOGIN}from\"../../constants\";import clientAxios from\"../../config/axios\";var AuthState=function AuthState(props){var initialState={token:localStorage.getItem(\"access\"),autenticated:null,user:null,message:null};var _useReducer=useReducer(AuthReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];/* const createUser = async (data) => {\r\n    try {\r\n      const response = await axiosClient.post(\"/api/users\", data);\r\n\r\n      dispatch({\r\n        type: REGISTERED,\r\n        payload: response.data,\r\n      });\r\n\r\n      // get user\r\n      autenticatedUser();\r\n    } catch (error) {\r\n    \r\n\r\n      dispatch({\r\n        type: REGISTER_ERROR,\r\n        payload: error,\r\n      });\r\n    }\r\n  }; */ // get autenticated user\nvar autenticatedUser=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var token,response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:token=localStorage.getItem(\"access\");if(token){tokenAuth(token);}_context.prev=2;_context.next=5;return clientAxios.get(\"profiles/?format=json&search=\".concat(localStorage.getItem(\"email\")));case 5:response=_context.sent;dispatch({type:GET_USER,payload:response.data[0]});_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](2);dispatch({type:GETUSER_ERROR});case 12:case\"end\":return _context.stop();}}},_callee,null,[[2,9]]);}));return function autenticatedUser(){return _ref.apply(this,arguments);};}();// login\nvar login=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(data){var response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return axios.post(API_URL_LOGIN,data);case 3:response=_context2.sent;document.cookie=\"access = \"+response.data.access;localStorage.setItem('refresh',response.data.refresh);localStorage.setItem('access',response.data.access);localStorage.setItem('email',data.email);dispatch({type:LOGIN_OK,payload:response.data});// get user\nautenticatedUser();_context2.next=15;break;case 12:_context2.prev=12;_context2.t0=_context2[\"catch\"](0);dispatch({type:LOGIN_ERROR,payload:\"Error! Try again\"});case 15:case\"end\":return _context2.stop();}}},_callee2,null,[[0,12]]);}));return function login(_x){return _ref2.apply(this,arguments);};}();// logout \nvar logout=function logout(){dispatch({type:LOG_OUT});};return/*#__PURE__*/React.createElement(AuthContext.Provider,{value:{token:state.token,autenticated:state.autenticated,user:state.user,message:state.message,// createUser,\nlogin:login,autenticatedUser:autenticatedUser,logout:logout}},props.children);};export default AuthState;","map":{"version":3,"sources":["/home/sofi/Documentos/SpatialArdhi/src/context/auth/AuthState.js"],"names":["React","useReducer","AuthContext","AuthReducer","tokenAuth","axios","REGISTERED","REGISTER_ERROR","GET_USER","LOGIN_OK","LOGIN_ERROR","GETUSER_ERROR","LOG_OUT","API_URL_LOGIN","clientAxios","AuthState","props","initialState","token","localStorage","getItem","autenticated","user","message","state","dispatch","autenticatedUser","get","response","type","payload","data","login","post","document","cookie","access","setItem","refresh","email","logout","children"],"mappings":"wcAAA,MAAOA,CAAAA,KAAP,EAAgBC,UAAhB,KAAkC,OAAlC,CACA,MAAOC,CAAAA,WAAP,KAAwB,eAAxB,CACA,MAAOC,CAAAA,WAAP,KAAwB,eAAxB,CACA,MAAOC,CAAAA,SAAP,KAAsB,oBAAtB,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CAEA,OACEC,UADF,CAEEC,cAFF,CAGEC,QAHF,CAIEC,QAJF,CAKEC,WALF,CAMEC,aANF,CAOEC,OAPF,KAQO,aARP,CASA,OAASC,aAAT,KAA8B,iBAA9B,CACA,MAAOC,CAAAA,WAAP,KAAwB,oBAAxB,CAEA,GAAMC,CAAAA,SAAS,CAAG,QAAZA,CAAAA,SAAY,CAACC,KAAD,CAAW,CAC3B,GAAMC,CAAAA,YAAY,CAAG,CACnBC,KAAK,CAAEC,YAAY,CAACC,OAAb,CAAqB,QAArB,CADY,CAEnBC,YAAY,CAAE,IAFK,CAGnBC,IAAI,CAAE,IAHa,CAInBC,OAAO,CAAE,IAJU,CAArB,CAD2B,gBAQDtB,UAAU,CAACE,WAAD,CAAcc,YAAd,CART,4CAQpBO,KARoB,iBAQbC,QARa,iBAS3B;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OA5B6B,CA8B3B;AACA,GAAMC,CAAAA,gBAAgB,0FAAG,sJACjBR,KADiB,CACTC,YAAY,CAACC,OAAb,CAAqB,QAArB,CADS,CAEvB,GAAIF,KAAJ,CAAW,CACTd,SAAS,CAACc,KAAD,CAAT,CACD,CAJsB,sCAOEJ,CAAAA,WAAW,CAACa,GAAZ,wCAAiDR,YAAY,CAACC,OAAb,CAAqB,OAArB,CAAjD,EAPF,QAOfQ,QAPe,eASrBH,QAAQ,CAAC,CACPI,IAAI,CAAErB,QADC,CAEPsB,OAAO,CAAEF,QAAQ,CAACG,IAAT,CAAc,CAAd,CAFF,CAAD,CAAR,CATqB,+EAerBN,QAAQ,CAAC,CACPI,IAAI,CAAElB,aADC,CAAD,CAAR,CAfqB,oEAAH,kBAAhBe,CAAAA,gBAAgB,0CAAtB,CAqBA;AACA,GAAMM,CAAAA,KAAK,2FAAG,kBAAOD,IAAP,2KAEa1B,CAAAA,KAAK,CAAC4B,IAAN,CAAWpB,aAAX,CAA0BkB,IAA1B,CAFb,QAEJH,QAFI,gBAGVM,QAAQ,CAACC,MAAT,CAAkB,YAAYP,QAAQ,CAACG,IAAT,CAAcK,MAA5C,CACAjB,YAAY,CAACkB,OAAb,CAAqB,SAArB,CAAgCT,QAAQ,CAACG,IAAT,CAAcO,OAA9C,EACAnB,YAAY,CAACkB,OAAb,CAAqB,QAArB,CAA+BT,QAAQ,CAACG,IAAT,CAAcK,MAA7C,EACAjB,YAAY,CAACkB,OAAb,CAAqB,OAArB,CAA8BN,IAAI,CAACQ,KAAnC,EAEAd,QAAQ,CAAC,CACPI,IAAI,CAAEpB,QADC,CAEPqB,OAAO,CAAEF,QAAQ,CAACG,IAFX,CAAD,CAAR,CAKA;AACAL,gBAAgB,GAdN,qFAgBVD,QAAQ,CAAC,CACPI,IAAI,CAAEnB,WADC,CAEPoB,OAAO,CAAE,kBAFF,CAAD,CAAR,CAhBU,uEAAH,kBAALE,CAAAA,KAAK,6CAAX,CAuBA;AACA,GAAMQ,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,EAAM,CACnBf,QAAQ,CAAC,CACPI,IAAI,CAAEjB,OADC,CAAD,CAAR,CAGD,CAJD,CAMA,mBACE,oBAAC,WAAD,CAAa,QAAb,EACE,KAAK,CAAE,CACLM,KAAK,CAAEM,KAAK,CAACN,KADR,CAELG,YAAY,CAAEG,KAAK,CAACH,YAFf,CAGLC,IAAI,CAAEE,KAAK,CAACF,IAHP,CAILC,OAAO,CAAEC,KAAK,CAACD,OAJV,CAKL;AACAS,KAAK,CAALA,KANK,CAOLN,gBAAgB,CAAhBA,gBAPK,CAQLc,MAAM,CAANA,MARK,CADT,EAYGxB,KAAK,CAACyB,QAZT,CADF,CAgBD,CAnGD,CAoGA,cAAe1B,CAAAA,SAAf","sourcesContent":["import React, { useReducer } from \"react\";\r\nimport AuthContext from \"./AuthContext\";\r\nimport AuthReducer from \"./AuthReducer\";\r\nimport tokenAuth from \"../../config/token\";\r\nimport axios from 'axios'\r\n\r\nimport {\r\n  REGISTERED,\r\n  REGISTER_ERROR,\r\n  GET_USER,\r\n  LOGIN_OK,\r\n  LOGIN_ERROR,\r\n  GETUSER_ERROR,\r\n  LOG_OUT,\r\n} from \"../../types\";\r\nimport { API_URL_LOGIN } from \"../../constants\";\r\nimport clientAxios from \"../../config/axios\";\r\n\r\nconst AuthState = (props) => {\r\n  const initialState = {\r\n    token: localStorage.getItem(\"access\"),\r\n    autenticated: null,\r\n    user: null,\r\n    message: null,\r\n  };\r\n\r\n  const [state, dispatch] = useReducer(AuthReducer, initialState);\r\n  /* const createUser = async (data) => {\r\n    try {\r\n      const response = await axiosClient.post(\"/api/users\", data);\r\n\r\n      dispatch({\r\n        type: REGISTERED,\r\n        payload: response.data,\r\n      });\r\n\r\n      // get user\r\n      autenticatedUser();\r\n    } catch (error) {\r\n    \r\n\r\n      dispatch({\r\n        type: REGISTER_ERROR,\r\n        payload: error,\r\n      });\r\n    }\r\n  }; */\r\n\r\n  // get autenticated user\r\n  const autenticatedUser = async () => {\r\n    const token = localStorage.getItem(\"access\");\r\n    if (token) {\r\n      tokenAuth(token);\r\n    }\r\n\r\n    try {\r\n      const response = await clientAxios.get( `profiles/?format=json&search=${localStorage.getItem(\"email\")}`);\r\n      \r\n      dispatch({\r\n        type: GET_USER,\r\n        payload: response.data[0],\r\n      });\r\n\r\n    } catch (error) {\r\n      dispatch({\r\n        type: GETUSER_ERROR,\r\n      });\r\n    }\r\n  };\r\n\r\n  // login\r\n  const login = async (data) => {\r\n    try {\r\n      const response = await axios.post(API_URL_LOGIN, data );\r\n      document.cookie = \"access = \"+response.data.access;\r\n      localStorage.setItem('refresh', response.data.refresh);\r\n      localStorage.setItem('access', response.data.access);\r\n      localStorage.setItem('email', data.email);\r\n\r\n      dispatch({\r\n        type: LOGIN_OK,\r\n        payload: response.data,\r\n      });\r\n\r\n      // get user\r\n      autenticatedUser();\r\n    } catch (error) {\r\n      dispatch({\r\n        type: LOGIN_ERROR,\r\n        payload: \"Error! Try again\",\r\n      });\r\n    }\r\n  };\r\n\r\n  // logout \r\n  const logout = () => {\r\n    dispatch({\r\n      type: LOG_OUT,\r\n    });\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        token: state.token,\r\n        autenticated: state.autenticated,\r\n        user: state.user,\r\n        message: state.message,\r\n        // createUser,\r\n        login,\r\n        autenticatedUser,\r\n        logout,\r\n      }}\r\n    >\r\n      {props.children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\nexport default AuthState;\r\n"]},"metadata":{},"sourceType":"module"}